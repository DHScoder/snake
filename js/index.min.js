let sw=20,sh=20,tr=30,td=30,snake=null,food=null,game=null,speed=200,die=document.querySelector(".die"),bj=document.querySelector(".bj"),chi=document.querySelector(".chi"),ong=document.querySelector(".ong");function Square(x,y,classname){this.x=x*sw,this.y=y*sh,this.class=classname,this.viewContent=document.createElement("div"),this.viewContent.className=this.class,this.parent=document.querySelector("#snakeWrap")}function Snake(){this.head=null,this.tail=null,this.pos=[],this.directionNum={left:{x:-1,y:0,rotate:180},right:{x:1,y:0,rotate:0},up:{x:0,y:-1,rotate:-90},down:{x:0,y:1,rotate:90}}}function createFood(){let x=null,y=null,include=!0;for(;include;)x=Math.round(Math.random()*(td-1)),y=Math.round(Math.random()*(tr-1)),snake.pos.forEach((function(value){x!=value[0]&&y!=value[1]&&(include=!1)}));food=new Square(x,y,"food"),food.pos=[x,y];let foodDom=document.querySelector(".food");foodDom?(foodDom.style.left=x*sw+"px",foodDom.style.top=y*sh+"px"):food.create()}function Game(){this.timer=null,this.score=0}Square.prototype.create=function(){this.viewContent.style.position="absolute",this.viewContent.style.width=sw+"px",this.viewContent.style.height=sh+"px",this.viewContent.style.left=this.x+"px",this.viewContent.style.top=this.y+"px",this.parent.appendChild(this.viewContent)},Square.prototype.remove=function(){this.parent.removeChild(this.viewContent)},Snake.prototype.init=function(){let snakeHead=new Square(2,0,"snakeHead");snakeHead.create(),this.head=snakeHead,this.pos.push([2,0]);let snakeBody1=new Square(1,0,"snakeBody");snakeBody1.create(),this.pos.push([1,0]);let snakeBody2=new Square(0,0,"snakeBody");snakeBody2.create(),this.tail=snakeBody2,this.pos.push([0,0]),snakeHead.last=null,snakeHead.next=snakeBody1,snakeBody1.last=snakeHead,snakeBody1.next=snakeBody2,snakeBody2.last=snakeBody1,snakeBody2.next=null,this.direction=this.directionNum.right},Snake.prototype.getNextPos=function(){let nextPos=[this.head.x/sw+this.direction.x,this.head.y/sw+this.direction.y],selfCollide=!1;return this.pos.forEach((function(value){value[0]==nextPos[0]&&value[1]==nextPos[1]&&(selfCollide=!0)})),selfCollide?(console.log("你无情的吃掉了自己！"),void this.strategies.die.call(this)):nextPos[0]<0||nextPos[1]<0||nextPos[0]>td-1||nextPos[1]>tr-1?(console.log("你因撞墙导致脑浆崩裂，死的非常凄惨！"),void this.strategies.die.call(this)):food&&food.pos[0]==nextPos[0]&&food.pos[1]==nextPos[1]?(console.log("吃掉它吧！"),void this.strategies.eat.call(this)):void this.strategies.move.call(this)},Snake.prototype.strategies={move:function(formate){let newBody=new Square(this.head.x/sw,this.head.y/sh,"snakeBody");newBody.next=this.head.next,newBody.next.last=newBody,newBody.last=null,this.head.remove(),newBody.create();let newHead=new Square(this.head.x/sw+this.direction.x,this.head.y/sw+this.direction.y,"snakeHead");newHead.next=newBody,newHead.last=null,newBody.last=newHead,newHead.viewContent.style.transform="rotate("+this.direction.rotate+"deg)",newHead.create(),this.pos.splice(0,0,[this.head.x/sw+this.direction.x,this.head.y/sw+this.direction.y]),this.head=newHead,formate||(this.tail.remove(),this.tail=this.tail.last,this.pos.pop())},eat:function(){this.strategies.move.call(this,!0),createFood(),ong.innerHTML=++game.score,chi.play()},die:function(){game.over()}},snake=new Snake,Game.prototype.init=function(){snake.init(),createFood(),document.addEventListener("keydown",(function(ev){let flag=0;"ArrowUp"!=ev.code&&"KeyW"!=ev.code||(flag=38),"ArrowDown"!=ev.code&&"KeyS"!=ev.code||(flag=40),"ArrowLeft"!=ev.code&&"KeyA"!=ev.code||(flag=37),"ArrowRight"!=ev.code&&"KeyD"!=ev.code||(flag=39),37==flag&&snake.direction!=snake.directionNum.right?snake.direction=snake.directionNum.left:38==flag&&snake.direction!=snake.directionNum.down?snake.direction=snake.directionNum.up:39==flag&&snake.direction!=snake.directionNum.left?snake.direction=snake.directionNum.right:40==flag&&snake.direction!=snake.directionNum.up&&(snake.direction=snake.directionNum.down)})),this.start()},Game.prototype.start=function(){this.timer=setInterval((function(){snake.getNextPos()}),speed++)},Game.prototype.pause=function(){clearInterval(this.timer)},Game.prototype.over=function(){let snakeWrap,startBtnWrap;clearInterval(this.timer),bj.pause(),die.play(),alert("你死了！"),bj.play(),document.querySelector("#snakeWrap").innerHTML="",snake=new Snake,game=new Game,document.querySelector(".startBtn").style.display="block",this.score=0,ong.innerHTML="0"},game=new Game;let startBtn=document.querySelector(".startBtn button");startBtn.addEventListener("click",(function(){bj.play(),startBtn.parentNode.style.display="none",game.init()}));let snakeWrap=document.querySelector("#snakeWrap"),pauseBtn=document.querySelector(".pauseBtn button");snakeWrap.addEventListener("click",(function(){game.pause(),pauseBtn.parentNode.style.display="block"})),pauseBtn.addEventListener("click",(function(){game.start(),pauseBtn.parentNode.style.display="none"}));